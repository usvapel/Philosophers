#    Makefile                                           :+:      :+:    :+:    #
#    Created: 2025/06/03 18:36:06 by jpelline          #+#    #+#              #
#    Updated: 2025/06/03 18:36:20 by jpelline         ###   ########.fr        #
CFLAGS		:= -Wextra -Wall -Werror
DEBUG_FLAGS	:= -g3 -fsanitize=address -fsanitize=undefined
MARKER_STANDARD := .standard_build
GREEN		:= $(shell tput setaf 2)
YELLOW		:= $(shell tput setaf 3)
BLUE		:= $(shell tput setaf 4)
MAGENTA		:= $(shell tput setaf 5)
CYAN		:= $(shell tput setaf 6)
WHITE		:= $(shell tput setaf 7)
SRCS		:= main.c utility.c parsing.c setup.c
OBJS		:= $(addprefix $(OBJ_DIR)/,$(SRCS:.c=.o))
LATEST_SRC	:= $(shell ls -t $(SRC_DIR)/*.c 2>/dev/null | head -n1)
OBJ_FILES_EXIST := $(shell [ -n "$(wildcard $(OBJ_DIR)/*.o)" ] && echo yes)
is_up_to_date = \
all:
	@if [ -f $(MARKER_STANDARD) ] && $(is_up_to_date) 2>/dev/null; then \
		echo ">$(BOLD)$(YELLOW)  $(NAME) is already up to date.$(RESET)"; \
		echo ">$(BOLD)$(WHITE) Starting to build $(NAME)...$(RESET)"; \
# Debug target
debug: clean $(NAME)
# Main executable target - links all objects and libraries
# Create necessary directories if they don't exist
# Compilation rule for each source file
		CURRENT=$$(cat $(PROGRESS_FILE)); \
# Include auto-generated dependency files
-include $(wildcard $(DEP_DIR)/*.d)
# Remove object files and dependency files
clean:
		echo "> [ pipex ] $(YELLOW) Cleaning object files...$(RESET)"; \
		echo "            $(YELLOW) Object files cleaned!$(RESET)"; \
		echo "> [ pipex ] $(BOLD)$(YELLOW) Nothing to be done with $(RESET)$(WHITE)clean$(RESET)"; \
# Remove everything including the executable
fclean: clean
		echo "> [ pipex ] $(BOLD)$(YELLOW) Nothing to be done with $(RESET)$(WHITE)fclean$(RESET)"; \
# Full rebuild from scratch
	@echo "> [ pipex ] $(BOLD)$(WHITE) Rebuilding from scratch...$(RESET)"
	@$(MAKE) fclean --no-print-directory
# Additional useful targets
	@echo "$(BOLD)$(CYAN)Available targets:$(RESET)"
	@echo "  $(GREEN)all$(RESET)     - Build the project (default)"
	@echo "  $(GREEN)debug$(RESET)   - Build with debug flags and sanitizers"
	@echo "  $(GREEN)clean$(RESET)   - Remove object files"
	@echo "  $(GREEN)fclean$(RESET)  - Remove all generated files"
	@echo "  $(GREEN)re$(RESET)      - Rebuild from scratch"
	@echo "  $(GREEN)help$(RESET)    - Show this help message"
# Prevent intermediate files from being deleted
.PHONY: all debug clean fclean re help
